<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Green</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- HTML5 Canvas polyfill，解决兼容性问题 -->
    <script>
    // 修复某些浏览器中的canvas兼容性问题
    if (!HTMLCanvasElement.prototype.toBlob) {
        Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {
            value: function(callback, type, quality) {
                const dataURL = this.toDataURL(type, quality);
                const binStr = atob(dataURL.split(',')[1]);
                const len = binStr.length;
                const arr = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    arr[i] = binStr.charCodeAt(i);
                }
                callback(new Blob([arr], {type: type || 'image/png'}));
            }
        });
    }
    </script>
    
    <!-- 加载face-api.js -->
    <script src="./opencv/emotion_model/face-api.js/dist/face-api.min.js"></script>
</head>
<body>
    <!-- 视频流 -->
    <video id="videoStream" autoplay playsinline></video>
    
    <!--webrtc状态显示切换按钮 -->
    <div id="status-toggle" class="status-toggle">i</div>
    
    <!-- 表情识别悬浮窗口 -->
    <div id="emotion-floating-window" class="emotion-floating-window">
        <div class="floating-header">
            <h3>表情识别</h3>
            <button id="floating-toggle-btn" disabled>等待初始化...</button>
            <button id="floating-close-btn">×</button>
        </div>
        <div class="floating-content">
            <div class="video-container">
                <video id="floating-video" autoplay playsinline></video>
                <canvas id="outputCanvas" class="overlay-canvas"></canvas>
            </div>
            <div class="emotion-panel">
                <div class="panel-header">
                    <h3>当前情绪</h3>
                </div>
                <div class="emotion-status">
                    <span id="current-emotion">未检测</span>
                </div>
                <div class="emotion-bar-container">
                    <div id="emotion-bar" class="emotion-bar"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 调试信息区域 -->
    <div id="debug-info"></div>
    
    <!-- 功能模块脚本 -->
    <script src="./opencv/emotion-recognition.js"></script>
    <script src="./opencv/emotion-ui.js"></script>
    <script src="./webrtc_config/ui.js"></script>
    <script src="./webrtc_config/renderer.js"></script>
</body>
</html>
